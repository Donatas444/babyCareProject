<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Baby care project</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script type="text/javascript" src="/javatest.js"></script>


</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="/">Home</a>
        </div>
    </div>
</nav>

<div class="container my-5">
    <h1 class="mb-5">Your baby's controller page</h1>
    <div>
        <h2>
            <label th:text="${baby.name} + ' feeding:'"></label>
        </h2>
    </div>

    <div class="row">
        <div class="col-sm-6">
            <div class="card">
                <div class="card-body">
                    <form id="form3" action="#" th:action="@{//addfoodtype}" th:object="${foodType}" method="post">
                        <div class="input-group mb-3">

                            <select id="purpose" class="custom-select">
                                <option selected>Choose...</option>

                                <option value="2">Breast feeding</option>
                                <option value="1">Formula</option>

                            </select>
                            <script>


                            </script>
                        </div>
                    </form>
                    <form id="form1" action="#" th:action="@{/addfeeding}" th:object="${feeding}" method="post">


                        <h5 class="card-title">Breast feeding</h5>
                        <p class="card-text">After pressing the "Start feeding" button timer starts to count your left
                            breast feeding time. After you finish, press "Stop feeding".</p>
                        <input type="hidden" name="feedingDate" id="feedingDate"
                               th:value="${#dates.format(#dates.createNow() , 'yyyy-MM-dd')}"/>
                        <input type="hidden" name="babyId" id="babyId" th:value="${baby.id}"/>


                        <div style='display:none;' id="business">
                            Enter feeded amount in ml<br/>&nbsp;
                            <br/>&nbsp;
                            <input type="text" placeholder="Enter amount in ml if formula is feeded."
                                   name="feedingAmount" th:value="${feedingAmount}"/>
                            <br/>
                        </div>

                        <div style='display:none;' id="business_new">
                            <div>
                                <label class="field">Start time:</label>
                                <input name="feedingTime" type="time" id="start"
                                       th:value="${#dates.format(#dates.createNow() , 'HH:mm')}">
                            </div>
                            <div>
                                <label class="field">Stop time:</label>
                                <input type="time" id="end"
                                       th:value="${#dates.format(#dates.createNow() , 'HH:mm')}"></input>
                            </div>
                        </div>

                        <input type="hidden" name="feedingPeriod" id="diff"/>
                        <div class="row">
                            <div class="col-md-6 mt-5">
                                <input type="submit" class="btn btn-warning btn-lg" value="Save entry">
                            </div>
                        </div>

                        <script>
var start = document.getElementById("start").value;
var end = document.getElementById("end").value;

document.getElementById("start").onchange = function() {diff(start,end)};
document.getElementById("end").onchange = function() {diff(start,end)};


function diff(start, end) {
    start = document.getElementById("start").value;
    end = document.getElementById("end").value;

    start = start.split(":");
    end = end.split(":");
    var startDate = new Date(0, 0, 0, start[0], start[1], 0);
    var endDate = new Date(0, 0, 0, end[0], end[1], 0);
    var diff = endDate.getTime() - startDate.getTime();
    var hours = Math.floor(diff / 1000 / 60 / 60);
    diff -= hours * 1000 * 60 * 60;
    var minutes = Math.floor(diff / 1000 / 60);

    return (hours < 9 ? "0" : "") + hours + ":" + (minutes < 9 ? "0" : "") + minutes;
}

setInterval(function(){document.getElementById("diff").value = diff(start, end);}, 1000);







                        </script>


                    </form>
                </div>
            </div>
        </div>


        <div class="col-sm-6">
            <div class="card">
                <div class="card-body">
                    <form id="form2" action="#" th:action="@{/addfeeding}" th:object="${feeding}" method="post">
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label class="col-form-label">Formula (ml)</label>
                                <input type="number" name="feedingAmount" class="form-control"
                                       placeholder="Enter amount in ml" step="1" th:value="${feedingAmount}">


                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mt-5">
                                <input type="submit" class="btn btn-warning btn-lg" value="Save entry">
                            </div>
                        </div>


                    </form>

                </div>
            </div>
            <br>
            <div class="card">
                <div class="card-body">
                    <form action="#" th:action="@{/adddiaper}" th:object="${diapers}" method="post">

                        <h6>
                            Diapers changed:
                        </h6>


                        <input type="hidden" name="dateDiapersChanged" id="dateDiapersChanged"
                               th:value="${#dates.format(#dates.createNow() , 'yyyy-MM-dd')}"/>

                        <input type="hidden" name="timeDiapersChanged" id="timeDiapersChanged"
                               th:value="${#dates.format(#dates.createNow() , 'HH:mm')}"/>
                        <input type="hidden" name="babyId" th:value="${baby.id}"/>

                        <!--      <div class="btn-group" role="group" aria-label="Basic example">
                                 <button type="button" class="btn btn-secondary">+</button>
                                 <button type="button" class="btn btn-secondary">-</button>

                        </div> -->
                        <div class="row">
                            <div class="col-md-6 mt-5">
                                <input type="submit" class="btn btn-warning btn-lg" value="Enter changed diapers">
                            </div>
                        </div>
                    </form>
                </div>
            </div>

        </div>
        <div class="col-md-6 mt-5">
            <input type="submit" class="btn btn-success btn-lg" value="Save all entries" onclick="submitForms()"/>
            <script>
    submitForms = function(){
    document.getElementById("form1").submit();
    document.getElementById("form2").submit();
    document.getElementById("form3").submit();

    }




            </script>
        </div>
    </div>
</div>


<div class="container">
    <div class="page-header">
        <h2>Baby info</h2>
    </div>
    <table class="table table-striped table-bordered">
        <tr>
            <th>Name</th>
            <th>Date</th>
        </tr>

        <tr>
            <td th:text="${baby.name}">Name
            </td>
            <td>
                <li th:each="feeding : ${feedings}"
                    th:if="(${feeding.babyId} == ${baby.id})"

                    th:text="${feeding.feedingDate}">Date
                </li>
            </td>
        </tr>
    </table>
</div>

<footer class="footer navbar-inverse navbar-fixed-bottom">
    <div class="container">
        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4"><p class="text-muted">2020 Donatas Lunys</p></div>
        </div>
    </div>
</footer>


<h2>
    <div>
        <span id="hour"></span>
        <span>: </span>
        <span id="minute"></span>
        <span>: </span>
        <span id="seconds"></span>
    </div>


    <button id="start-btn">Start</button>
    <button id="stop-btn">Stop</button>
    <button id="reset-btn">Reset</button>
</h2>
<script>    window.onload = () => {
    let hour = 0;
    let minute = 0;
    let seconds = 0;
    let totalSeconds = 0;

    function startTimer() {
        ++totalSeconds;
        hour = Math.floor(totalSeconds /3600);
        minute = Math.floor((totalSeconds - hour*3600)/60);
        seconds = totalSeconds - (hour*3600 + minute*60);

        document.getElementById("hour").innerHTML =hour;
        document.getElementById("minute").innerHTML =minute;
        document.getElementById("seconds").innerHTML =seconds;
    }

    document.getElementById('start-btn').addEventListener('click', () => {
        intervalId = setInterval(startTimer, 1000);
    })

    document.getElementById('stop-btn').addEventListener('click', () => {
        if (intervalId)
            clearInterval(intervalId);
    });


    document.getElementById('reset-btn').addEventListener('click', () => {
        totalSeconds = 0;
        document.getElementById("hour").innerHTML = '0';
        document.getElementById("minute").innerHTML = '0';
        document.getElementById("seconds").innerHTML = '0';
    });
}














</script>


<form>

</form>

</body>
</html>